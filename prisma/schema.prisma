// ============================================================================
// PRISMA SCHEMA - AUTO-GENERADO
// ============================================================================
// ⚠️  NO EDITAR DIRECTAMENTE - Este archivo se genera automáticamente
//
// Para modificar el schema:
//   1. Editar archivos en prisma/schemas/
//   2. Ejecutar: npm run schema:merge
//
// Generado: 2026-02-08T02:22:25.228Z
// Fuentes: base.prisma, configuracion.prisma, inventario.prisma
// ============================================================================

// En Prisma 7.x la URL se configura en prisma.config.ts
// y se pasa al constructor de PrismaClient

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

/**
 * CONFIGURACIÓN Module - Database Schema
 *
 * Modelos para gestionar parámetros operativos y políticas del sistema.
 *
 * Enums:
 * - TipoDato: Tipo de validación para parámetros (ENTERO, DECIMAL, BOOLEAN)
 * - TipoPolitica: Categoría de políticas (CAMBIOS, ENVIOS, TERMINOS)
 * - EstadoPolitica: Ciclo de vida de política (BORRADOR, VIGENTE, ARCHIVADA)
 *
 * Invariantes:
 * - parametro_operativo.clave: UNIQUE (identificador del negocio)
 * - politica (tipo, version): UNIQUE (evita duplicados)
 * - politica (tipo, estado=VIGENTE): solo una activa por tipo (enforced en app)
 *
 * Notas:
 * - Duraciones se almacenan como ENTERO (en segundos)
 * - Eliminados TEXTO y DURACION de TipoDato en v2.1
 */

enum TipoDato {
  ENTERO
  DECIMAL
  BOOLEAN

  @@map("tipo_dato")
}

enum TipoPolitica {
  CAMBIOS
  ENVIOS
  TERMINOS

  @@map("tipo_politica")
}

enum EstadoPolitica {
  BORRADOR
  VIGENTE
  ARCHIVADA

  @@map("estado_politica")
}

/**
 * ParametroOperativo: Parámetro operativo del sistema.
 *
 * Representa un parámetro configurable sin necesidad de recompilación.
 * Los valores son validados según su tipo_dato antes de persistirse.
 *
 * Campos:
 * - id: UUID v7 (generado por BD)
 * - clave: Identificador único (ej: DURACION_RESERVA_VENTA)
 * - nombre: Nombre descriptivo para UI
 * - descripcion: Documentación opcional
 * - tipo_dato: Enum para validación (ENTERO, DECIMAL, BOOLEAN)
 * - valor: Valor actual (string, validado según tipo_dato)
 * - valor_defecto: Valor por defecto (para reset)
 * - valor_minimo: Límite inferior (opcional, solo para ENTERO/DECIMAL)
 * - valor_maximo: Límite superior (opcional, solo para ENTERO/DECIMAL)
 * - requiere_reinicio: Si true, cambios requieren reinicio de app
 * - modificado_por: UUID de empleado que modificó (nullable)
 * - fecha_modificacion: Timestamp de última modificación
 *
 * Relaciones:
 * - None (standalone)
 *
 * Índices:
 * - UNIQUE en clave (lookup primario)
 * - INDEX en modificado_por (auditoría)
 */
model ParametroOperativo {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clave              String    @unique
  nombre             String    @db.VarChar(100)
  descripcion        String?   @db.Text
  tipoDato           TipoDato  @map("tipo_dato")
  valor              String    @db.VarChar(500)
  valorDefecto       String    @map("valor_defecto") @db.VarChar(500)
  valorMinimo        String?   @map("valor_minimo") @db.VarChar(100)
  valorMaximo        String?   @map("valor_maximo") @db.VarChar(100)
  requiereReinicio   Boolean   @default(false) @map("requiere_reinicio")
  modificadoPor      String?   @map("modificado_por") @db.Uuid
  fechaModificacion  DateTime  @default(now()) @updatedAt @map("fecha_modificacion")

  @@index([clave], name: "idx_parametro_operativo_clave")
  @@index([modificadoPor], name: "idx_parametro_operativo_modificado_por")
  @@map("parametro_operativo")
}

/**
 * Politica: Política versionada del negocio.
 *
 * Representa una política legal/operativa (cambios, envíos, términos) con versionado.
 * Ciclo de vida: BORRADOR → VIGENTE → ARCHIVADA
 * Solo una política VIGENTE por tipo.
 *
 * Campos:
 * - id: UUID v7 (generado por BD)
 * - tipo: Enum CAMBIOS | ENVIOS | TERMINOS
 * - version: Versión semántica (X.Y.Z) para trazabilidad
 * - contenido: Texto completo de la política
 * - estado: BORRADOR (en revisión) | VIGENTE (activa) | ARCHIVADA (obsoleta)
 * - fecha_vigencia_desde: Cuándo comienza a aplicar (null si no publicada)
 * - fecha_vigencia_hasta: Cuándo deja de aplicar (null si aún vigente)
 * - publicado_por: UUID de empleado que publicó (nullable)
 * - fecha_creacion: Cuándo fue creada
 *
 * Relaciones:
 * - None (standalone)
 *
 * Índices:
 * - UNIQUE en (tipo, version) para evitar duplicados
 * - INDEX en tipo (lookup por tipo)
 * - INDEX en estado (para queries por estado)
 * - COMPOSITE INDEX en (tipo, estado) para "una vigente por tipo"
 */
model Politica {
  id                  String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tipo                TipoPolitica     @map("tipo")
  version             String           @db.VarChar(10)
  contenido           String           @db.Text
  estado              EstadoPolitica   @default(BORRADOR) @map("estado")
  fechaVigenciaDesde  DateTime?        @map("fecha_vigencia_desde") @db.Date
  fechaVigenciaHasta  DateTime?        @map("fecha_vigencia_hasta") @db.Date
  publicadoPor        String?          @map("publicado_por") @db.Uuid
  fechaCreacion       DateTime         @default(now()) @map("fecha_creacion")

  @@unique([tipo, version], name: "idx_politica_tipo_version")
  @@index([tipo], name: "idx_politica_tipo")
  @@index([estado], name: "idx_politica_estado")
  @@index([tipo, estado], name: "idx_politica_tipo_estado")
  @@map("politica")
}

enum TipoItem {
  PRODUCTO
  PAQUETE

  @@map("tipo_item")
}

enum TipoOperacion {
  VENTA
  CAMBIO
  AJUSTE

  @@map("tipo_operacion")
}

enum EstadoReserva {
  ACTIVA
  CONSOLIDADA
  LIBERADA
  EXPIRADA

  @@map("estado_reserva")
}

enum TipoMovimiento {
  VENTA_SALIDA
  CAMBIO_SALIDA
  CAMBIO_ENTRADA
  AJUSTE_OPERATIVO
  AJUSTE_CONTABLE
  RESERVA
  LIBERACION
  ABANDONO_ENTRADA
  ABANDONO_SALIDA

  @@map("tipo_movimiento")
}

enum TipoActor {
  EMPLEADO
  CLIENTE
  SISTEMA

  @@map("tipo_actor")
}

model Inventario {
  id                 String   @id @default(uuid()) @db.Uuid
  tipoItem           TipoItem @map("tipo_item")
  itemId             String   @map("item_id") @db.Uuid
  ubicacion          String?  @db.VarChar(50) @map("ubicacion")
  cantidadDisponible Int      @default(0) @map("cantidad_disponible")
  cantidadReservada  Int      @default(0) @map("cantidad_reservada")
  cantidadAbandono   Int      @default(0) @map("cantidad_abandono")
  version            Int      @default(1) @map("version")
  fechaActualizacion DateTime @updatedAt @map("fecha_actualizacion")
  deleted            Boolean  @default(false) @map("deleted")

  reservas    Reserva[]
  movimientos MovimientoInventario[]

  @@unique([tipoItem, itemId], name: "idx_inventario_item")
  @@index([ubicacion], name: "idx_inventario_ubicacion")
  @@index([deleted], name: "idx_inventario_deleted")
  @@map("inventario")
}

model Reserva {
  id              String        @id @default(uuid()) @db.Uuid
  inventarioId    String        @map("inventario_id") @db.Uuid
  tipoOperacion   TipoOperacion @map("tipo_operacion")
  operacionId     String        @map("operacion_id") @db.Uuid
  cantidad        Int           @map("cantidad")
  estado          EstadoReserva @default(ACTIVA) @map("estado")
  fechaCreacion   DateTime      @default(now()) @map("fecha_creacion")
  fechaExpiracion DateTime      @map("fecha_expiracion")
  fechaResolucion DateTime?     @map("fecha_resolucion")
  actorTipo       TipoActor     @map("actor_tipo")
  actorId         String        @map("actor_id") @db.Uuid

  inventario Inventario @relation(fields: [inventarioId], references: [id], onDelete: Cascade)

  @@index([inventarioId], name: "idx_reserva_inventario")
  @@index([estado], name: "idx_reserva_estado")
  @@index([fechaExpiracion, estado], name: "idx_reserva_expiracion")
  @@index([operacionId], name: "idx_reserva_operacion")
  @@map("reserva")
}

model MovimientoInventario {
  id                  String         @id @default(uuid()) @db.Uuid
  inventarioId        String         @map("inventario_id") @db.Uuid
  tipoMovimiento      TipoMovimiento @map("tipo_movimiento")
  cantidad            Int            @map("cantidad")
  cantidadAnterior    Int            @map("cantidad_anterior")
  cantidadPosterior   Int            @map("cantidad_posterior")
  tipoOperacionOrigen TipoOperacion? @map("tipo_operacion_origen")
  operacionOrigenId   String?        @map("operacion_origen_id") @db.Uuid
  empleadoId          String?        @map("empleado_id") @db.Uuid
  intencion           String?        @db.VarChar(200)
  notas               String?        @db.Text
  fechaMovimiento     DateTime       @default(now()) @map("fecha_movimiento")

  inventario Inventario @relation(fields: [inventarioId], references: [id], onDelete: Cascade)
  // TODO: Agregar relación a Empleado cuando IDENTIDAD esté disponible

  @@index([inventarioId], name: "idx_movimiento_inventario")
  @@index([fechaMovimiento], name: "idx_movimiento_fecha")
  @@index([tipoMovimiento], name: "idx_movimiento_tipo")
  @@map("movimiento_inventario")
}